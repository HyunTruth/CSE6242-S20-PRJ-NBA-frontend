---
title: "PlotDrafts"
author: "Stephen Pelkofer"
date: "3/18/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Imports
Packages needed

```{r}
library(tidyverse)
library(highcharter) #interactive plotting library
library(tibbletime)
```

## Data

```{r}
GameLogs <- read.csv("C:/MAMP/htdocs/FinalGameLogs.csv")
levels(GameLogs$Distance) <- c("0-4ft","10-14ft","15-19ft","20-24ft","25-29ft","5-9ft")
GameLogs$Game_Date <- as.Date(GameLogs$Game_Date)
```


```{r}
BoxScores <- read.csv("../data/BoxScores.csv")
```


## Plotting

# Custom Color Paletes
```{r}
BlueSeqColors <- c( #light to dark blue
   "#f1eef6",
   "#bdc9e1",
   "#74a9cf",
   "#2b8cbe",
   "#045a8d"
)

QualColors <- c( #category/qualitative/groups
  '#386cb0',
  "#7fc97f",
  "#beaed4",
  "#fdc086",
  "#ffff99"
)
ScatterOppacity <- c(
  "rgba(55,126,184,.70)",
  "rgba(255,127,0,.85)"
)
```


# (1.a) Shots Defended vs DFG% Scatter
Resource: http://rstudio-pubs-static.s3.amazonaws.com/470388_85579e7a31b8402ebbc26ba86e6100ca.html
Filters: Shots Defended, Distance, Team, Opponent, Season
Ideas:
- Change between shots/36 and total shots


```{r}
DFG_Percentage <- GameLogs %>%
  filter(Season == "2019-20",
         Distance == "0-4ft") %>%
  group_by(idPlayer,Player,Distance) %>%
  summarise(T_DFGM = sum(DFGM), T_DFGA = sum(DFGA), Min = sum(minutes)) %>%
  mutate(DFG_Percent = round(T_DFGM/T_DFGA,3), ShotsDefended_Per36 = round((T_DFGM/Min)*36,1)) %>%
  filter(T_DFGA >= 150)

hchart(DFG_Percentage, "scatter",opacity = 0.65,
       hcaes(x = "ShotsDefended_Per36", y = "DFG_Percent",opacity = .5,
                                        group = "Distance",
                                        name = "Player", DFGA_36  = "ShotsDefended_Per36", 
                                        DFGEfficiency = "DFG_Percent", Distance = "Distance")) %>%
  hc_tooltip(pointFormat = "<b>{point.name}</b><br />DFGA/36: {point.DFGA_36}<br />DFG%: {point.DFGEfficiency}") %>%
  hc_title(text = "DFGA vs. DFG%") %>%
  hc_subtitle(text = "NBA 2019-2020 Season") %>%
  hc_credits(enabled = TRUE,
             text = "data via stats.nba.com",
             style = list(
               fontSize = "10px"
               )
             ) %>%
  hc_add_theme(hc_theme_elementary()) %>%
  hc_colors(Q2)
```

# (1.b) DFG% Line by Team

```{r}
Running_DFGP <- GameLogs %>%
  filter(Season == "2019-20",
         Distance == "10-14ft",
         Team == "MIL") %>%
  group_by(Team,Game_Date) %>%
  summarise(DFGM = sum(DFGM), DFGA = sum(DFGA))
```


```{r}
rolling <- rollify(mean,window = 5,na_value = 0)
Running_DFGP <- GameLogs %>%
  filter(Season == "2019-20",
         Distance == "10-14ft",
         Team == "MIL") %>%
  group_by(Team,Game_Date) %>%
  summarise(DFGM = sum(DFGM), DFGA = sum(DFGA)) %>%
  mutate(DFGP = round(DFGM/DFGA,2),
         RollingDFGP = round(if_else(rolling(DFGP) == 0, lag(DFGP), rolling(DFGP)),2))

hchart(Running_DFGP, "spline", hcaes(x = "Game_Date", y = "RollingDFGP", group = "Team",
                                        team = "Team", Date  = "Game_Date",
                                        DFGP = "RollingDFGP")) %>%
  hc_tooltip(pointFormat = "<b>{point.team}</b><br />DFG%: {point.DFGP}") %>%
  hc_title(text = "DFG% Season Trend") %>%
  hc_credits(enabled = TRUE,
             text = "data via stats.nba.com",
             style = list(
               fontSize = "10px"
               )
             ) %>%
  hc_add_theme(hc_theme_elementary()) %>%
  hc_colors(QualColors[2])

```





# (2) DFG% Rating Table
Resource: https://glin.github.io/reactable/articles/womens-world-cup/womens-world-cup.html
Ideas:
- vs league average
- percentile (nba already does this)


# (3) Shot zone map
Resource
https://github.com/toddwschneider/ballr/blob/master/court_themes.R

Ideas:
- Custom area or polygon chart? Only need tooltip to show DFG%
- How to draw court lines over it?

```{r}
source("C:/Users/Spelk/Desktop/Georgia Tech Analytics/CSE 6242/CSE6242-S20-PRJ-NBA-frontend/NBADefensiveAnalytics/R/court.R")

#unique(court_points$desc)
plot_court()
```


# (4) Player Cluster Model
Resource:
Ideas:







